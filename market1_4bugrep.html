<script>
    let fruits = [[`Apel`, 10_000, 5], [`Anggur`, 15_000, 5], [`Pisang`, 20_000, 5]]
    let cart = []
    let totalPrice = 0

    while(true) {
        let menuUtama = +prompt(`Selamat Datang di Toko Buah FRESH:
        1. Daftar Buah
        2. Tambah Buah
        3. Hapus Buah
        4. Beli Buah
        5. Exit`)

        if(menuUtama == 1) {
            let list = `Daftar Buah: \n`
            for (i = 0; i < fruits.length; i++) {
                list += `${i + 1}. ${fruits[i][0]} = ${fruits[i][1].toLocaleString()}/Kg. Stock = ${fruits[i][2]}\n`
            }
            alert(list)

        } else if(menuUtama == 2) {
            let newData = []
            while(true) {
                let name = prompt(`Silahkan masukkan nama buah yang ingin anda tambahkan?`)
                if (!name) {
                    alert(`Mohon masukkan input yang sesuai`)
                } else {
                    newData.push(name)
                    break
                }
            }
            while(true) {
                let price = +prompt(`Berapa harga buah ${name}/kg?`)
                if (!price) {
                    alert(`Mohon masukkan input yang sesuai`)
                } else {
                    newData.push(price)
                    break
                }
            }
            while(true) {
                let stock = +prompt(`Berapa banyak stock buah ${name} yang ingin anda tambahkan?`)
                if(!stock) {
                    alert(`Mohon masukkan input yang sesuai`)
                } else {
                    newData.push(stock)
                    break
                }
            }
            fruits.push(newData)
            alert(`Buah ${newData[0]} berhasil ditambahkan`)

        } else if(menuUtama == 3) {
            let list = `Daftar Buah: \n`
            for (i = 0; i < fruits.length; i++) {
                list += `${i + 1}. ${fruits[i][0]} = ${fruits[i][1].toLocaleString()}/Kg. Stock = ${fruits[i][2]}\n`
            }
            list += `Silahkan masukkan NOMOR urutan buah yang ingin Anda hapus:`
            let index = +prompt(list)
            fruits.splice(index - 1, 1)
            alert(`Data buah ke-${index} berhasil dihapus`)

        } else if(menuUtama == 4) {
            // while dibawah ini adalah looping besar untuk membeli buah
            while (true) {
                //menampilkan data buah dan meminta user memilih buah yang akan dibeli
                let list = `Daftar Buah: \n`
                for (i = 0; i < fruits.length; i++) {
                    list += `${i + 1}. ${fruits[i][0]} = ${fruits[i][1].toLocaleString()}/Kg. Stock = ${fruits[i][2]}\n`
                }
                list += `Silahkan masukkan NOMOR urutan buah yang ingin Anda beli:`
                let index = +prompt(list)
                //while dibawah ini untuk looping meminta qty pembelian
                while(true) {
                    // meminta user menentukan kuantitas buah yang akan dibeli
                    let qty = +prompt(`Berapa banyak buah ${fruits[index - 1][0]} yang ingin Anda beli? Stok tersedia = ${fruits[index - 1][2]}.`)
                    if(qty > fruits[index - 1][2]) {
                        // jika qty lebih dari stok maka akan muncul alert dan kembali meminta memasukkan qty buah yg akan dibeli 
                        alert(`Jumlah yang anda masukkan melebih stok kami. Mohon input tidak melebihi jumlah stok`)
                    } else if(qty <= fruits[index - 1][2]) {
                        // jika qty tdk melebihi stok maka akan mengisi nama, harga, dan qty kedalam cart
                        let ind = null
                            for(i = 0; i < cart.length; i++) {
                                if(cart[i][0] == fruits[index - 1][0]) {
                                    ind = i
                            }
                        }
                        if(ind == null){
                            cart.push([fruits[index-1][0], fruits[index-1][1], qty])
                            fruits[index-1][2] -= qty 
                        } else {
                            let temp = cart[ind][2] + qty
                            cart[ind][2] = temp
                            fruits[index-1][2] -= qty 
                        }
                        
                        //untuk menghitung total price di dalam cart
                        let count = 0
                        for(i = 0; i < cart.length; i++) {
                            count += cart[i][1] * cart[i][2]
                        }
                        totalPrice = count
                        alert(`Buah ${fruits[index-1][0]} berhasil ditambahkan kedalam keranjang`)

                        // setiap kali berhasil menambah buah kedalam cart akan muncul alert list buah dalam cart
                        let keranjang = `Daftar isi keranjang Anda saat ini:\n`
                        for(let i = 0; i < cart.length; i++) {
                            keranjang += `${i + 1}. ${cart[i][0]}, Rp.${cart[i][1].toLocaleString()}/kg x ${cart[i][2]} = Rp.${(cart[i][1] * cart[i][2]).toLocaleString()}\n` 
                        }
                        keranjang += `Total belanja Anda = Rp.${totalPrice.toLocaleString()}`
                        alert(keranjang)  
                        break
                    }
                }
                // meminta konfirmasi apakah user masih ingin membeli buah yang lain atau tidak? jika iya akan kembali lagi ke menu pembelian
                let konfirmasi = confirm(`Apakah Anda ingin membeli buah lagi?`)
                // jika user sudah tidak ingin membeli buah yang lain maka akan lanjut ke menu payment
                if(!konfirmasi) break

            }
            // while dibawah adalah looping besar untu payment
            while(true){
                // untuk menampilkan isi keranjang dan meminta input nominal pembayaran
                let keranjang = `Daftar isi keranjang Anda saat ini:\n`
                for(let i = 0; i < cart.length; i++) {
                    keranjang += `${i + 1}. ${cart[i][0]}, Rp.${cart[i][1].toLocaleString()}/kg x ${cart[i][2]} = Rp.${(cart[i][1] * cart[i][2]).toLocaleString()}\n` 
                }
                keranjang += `Total belanja Anda = Rp.${totalPrice.toLocaleString()}\nMohon input nominal untuk pembayaran: `
                let nominal = +prompt(keranjang)
                // kalau uang kurang, muncul alert dan kembali lagi meminta memasukkan nominal
                if(nominal < totalPrice) {
                    alert(`Mohon masukkan nominal yang sesuai yaitu Rp.${totalPrice.toLocaleString()}`)
                // kalau uang pas, muncul alert, looping payment stop, loop kembali ke menuawal
                } else if(nominal == totalPrice) {
                    alert(`Terimakasih, pesanan Anda akan segera diantar`)
                    cart = []
                    break
                // kalau uang lebih, muncul alert jumlah kembalian, looping payment stop, loop kembali ke menuawal
                } else if(nominal > totalPrice) {
                    alert(`Terimakasih, uang kembalian Anda adalah Rp.${(nominal - totalPrice).toLocaleString()}.\nPesanan Anda akan segera diantar`)
                    cart = []
                    break
                }
            }

        } else if(menuUtama == 5) {
            alert(`Terimakasih, Silahkan datang kembali`)
            break
        } else {
            alert(`Mohon maaf menu yang Anda pilih tidak tersedia, silahkan pilih kembali!`)
        }
    }
</script>