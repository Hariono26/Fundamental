<script>
    let product = [
        {
            name: `Apple`,
            price: 10000,
            stock: 5, 
            sugarLevel: `Medium`,
            category: `Fruit` 
        },
        {
            name: `Burger`,
            price: 15000,
            stock: 5,
            expired: 2022,
            category: `Fast Food`
        },
        {
            name: `Shirt`,
            price: 80000,
            stock: 5,
            size: `XXL`,
            category: `Cloth`
        },
        {
            name: `Fan`,
            price: 50000,
            stock: 5,
            warranty: true,
            category: `Electronic`
        }
    ]

    let cart = []
    let totalPrice = 0

    class Product {
        constructor(name, price, stock) {
            this.name = name,
            this.price = price,
            this.stock = stock
        }
    }
    class Fruit extends Product {
        constructor(name, price, stock, category, sugarLevel) {
            super(name, price, stock)
            this.sugarLevel = sugarLevel,
            this.category = category
        }
    }
    class FastFood extends Product {
        constructor(name, price, stock, category, expired) {
            super(name, price, stock)
            this.expired = expired,
            this.category = category
        }
    }
    class Cloth extends Product {
        constructor(name, price, stock, category, size) {
            super(name, price, stock)
            this.size = size,
            this.category = category
        }
    }
    class Electronic extends Product {
        constructor(name, price, stock, category, warranty) {
            super(name, price, stock)
            this.warranty = warranty,
            this.category = category
        }
    }

    let showList = () => {
        let res = `Daftar Produk: \n`
        product.forEach((item, index) => {
            let temp = `${index + 1}. `
            for(let prop in item) { 
                if(prop === 'category') {
                    temp += `Kategori: ${item[prop]}. `
                } else if (prop === `name`){
                    temp += `${item[prop]}= `
                } else if (prop === `price`){
                    temp += `Rp.${item[prop].toLocaleString()}, `
                } else if (prop === `stock`){
                    temp += `Stock: ${item[prop]}, `
                } else if (prop === `sugarLevel`){
                    temp += `Sugar Level: ${item[prop]}, `
                } else if (prop === `expired`){
                    temp += `Expired: ${item[prop]}, `
                } else if (prop === `size`){
                    temp += `Size: ${item[prop]}, `
                } else if (prop === `warranty`){
                    temp += `Warranty: ${item[prop]}, `
                } 
            }
            res += temp + `\n`
        })
        return res 
    }

    let showCart = () => {
        let res = `Daftar isi keranjang Anda saat ini:\n`
        cart.forEach((item, index) =>{
            res += `${index + 1}. ${item.name}, Rp.${item.price.toLocaleString()}/Kg x ${item.qty} = Rp.${(item.price * item.qty).toLocaleString()}\n`
        })
        res += `Total belanja Anda = Rp.${totalPrice.toLocaleString()}\n`
        return res
    }
    
    while(true) {
        let menuUtama = +prompt(`Selamat Datang di ToSerBa:
        1. Daftar Produk
        2. Tambah Produk
        3. Hapus Produk
        4. Beli Produk
        5. Exit`)

        if(menuUtama == 1) {
            let list = showList()
            alert(list)

        } else if(menuUtama == 2) {
            while(true) {
                let indexCategory = +prompt(`Silahkan pilih KATEGORI produk yang ingin ditambahkan:
                1. Fruit
                2. Fast Food
                3. Cloth
                4. Electronic`)

                if (indexCategory === 1) {
                    let name = prompt(`Tulis NAMA buah yang ingin ditambahkan:`)
                    let price = +prompt(`Berapa HARGA ${name}/Kg?`)
                    let stock = +prompt(`Berapa banyak STOCK ${name} yang ingin ditambahkan?`)
                    let sugarLevel = prompt(`Berapa KADAR GULA ${name}? (Tulis: Low/ Medium/ High)`)

                    let buah = new Fruit(name, price, stock, `Fruit`, sugarLevel)
                    product.push(buah)

                    alert(`${name} berhasil ditambahkan`)

                    let konfirmasi = confirm(`Apakah ada barang lain yang ingin ditambahkan?`)
                    if(!konfirmasi) break
                } else if (indexCategory === 2) {
                    let name = prompt(`Tulis NAMA makanan/minuman yang ingin ditambahkan:`)
                    let price = +prompt(`Berapa HARGA ${name}?`)
                    let stock = +prompt(`Berapa banyak STOCK ${name} yang ingin ditambahkan?`)
                    let expired = +prompt(`Silahkan masukkan Tahun Kadaluarsa dari ${name}?`)

                    let makanan = new FastFood(name, price, stock, `Fast Food`, expired)
                    product.push(makanan)

                    alert(`${name} berhasil ditambahkan`)

                    let konfirmasi = confirm(`Apakah ada barang lain yang ingin ditambahkan?`)
                    if(!konfirmasi) break
                } else if (indexCategory === 3) {
                    let name = prompt(`Tulis JENIS pakaian yang ingin ditambahkan:`)
                    let price = +prompt(`Berapa HARGA ${name}?`)
                    let stock = +prompt(`Berapa banyak STOCK ${name} yang ingin ditambahkan?`)
                    let size = prompt(`Silahkan masukkan ukuran ${name}? (Tulis: S/ M/ L/ XL/ XXL/ XXXL)`)

                    let pakaian = new Cloth(name, price, stock, `Cloth`, size)
                    product.push(pakaian)

                    alert(`${name} berhasil ditambahkan`)

                    let konfirmasi = confirm(`Apakah ada barang lain yang ingin ditambahkan?`)
                    if(!konfirmasi) break
                } else if (indexCategory === 4) {
                    let name = prompt(`Tulis NAMA produk eletronik yang ingin ditambahkan:`)
                    let price = +prompt(`Berapa HARGA ${name}?`)
                    let stock = +prompt(`Berapa banyak STOCK ${name} yang ingin ditambahkan?`)
                    let warranty = prompt(`Apakah ${name} memiliki garansi? (tulis: Ada/ Tidak)`)
                    if (warranty === `Ada`) {
                        warranty = true
                    } else {
                        warranty = false
                    }
                    let elektro = new Electronic(name, price, stock, `Electronic`, warranty)
                    product.push(elektro)

                    alert(`${name} berhasil ditambahkan`)

                    let konfirmasi = confirm(`Apakah ada barang lain yang ingin ditambahkan?`)
                    if(!konfirmasi) break
                } else {
                    alert(`Mohon maaf menu yang Anda pilih tidak tersedia, Silahkan pilih kembali`)
                }
            }

        } else if(menuUtama == 3) {
            let list = showList()
            list += `Silahkan masukkan NOMOR URUT produk yang ingin Anda hapus:`
            let index = +prompt(list)
            product.splice(index - 1, 1)
            alert(`Data produk ke-${index} berhasil dihapus`)

        } else if(menuUtama == 4) {
            while(true) {
                let list = showList()
                list += `Silahkan masukkan NOMOR URUT produk yang ingin Anda beli:`
                let indexBuy = +prompt(list)

                while(true) {
                    let qty = +prompt(`Berapa banyak ${product[indexBuy - 1].name} yang ingin Anda beli? Stok tersedia = ${product[indexBuy - 1].stock}.`)
                    if(qty > product[indexBuy - 1].stock) {
                        alert(`Jumlah yang anda masukkan melebih stok kami. Mohon input tidak melebihi jumlah stok`)
                    } else if (qty <= product[indexBuy - 1].stock) {
                        let ind = null
                        cart.forEach((item, indexCart) => {
                            if(item.name === product[indexBuy-1].name) {
                                ind = indexCart
                            }
                        })
                        if(ind === null){
                            cart.push({
                                name: product[indexBuy-1].name, 
                                price: product[indexBuy-1].price, 
                                qty
                            })
                            product[indexBuy-1].stock -= qty 
                        } else {
                            let temp = cart[ind].qty + qty
                            cart[ind].qty = temp
                            product[indexBuy-1].stock -= qty 
                        }

                        let count = 0
                        cart.forEach(item => {
                            count += item.price * item.qty
                        })
                        totalPrice = count
                        alert(`${product[indexBuy-1].name} berhasil ditambahkan kedalam keranjang`)

                        let keranjang = showCart()
                        alert(keranjang)
                        break
                    }
                }
                let konfirmasi = confirm(`Apakah Anda ingin membeli produk yang lain?`)
                if(!konfirmasi) break
            }
            while(true){
                let keranjang = showCart()
                keranjang += `Mohon input nominal untuk pembayaran: `
                let nominal = +prompt(keranjang)

                if(nominal < totalPrice) {
                    alert(`Mohon masukkan nominal yang sesuai yaitu Rp.${totalPrice.toLocaleString()}`)
                } else if(nominal == totalPrice) {
                    alert(`Terimakasih, pesanan Anda akan segera diantar`)
                    cart = []
                    break
                } else if(nominal > totalPrice) {
                    alert(`Terimakasih, uang kembalian Anda adalah Rp.${(nominal - totalPrice).toLocaleString()}.\nPesanan Anda akan segera diantar`)
                    cart = []
                    break
                }
            }

        } else if(menuUtama == 5) {
            alert(`Terimakasih, Silahkan datang kembali`)
            break
        } else {
            alert(`Mohon maaf menu yang Anda pilih tidak tersedia, silahkan pilih kembali!`)
        }
    }
</script>